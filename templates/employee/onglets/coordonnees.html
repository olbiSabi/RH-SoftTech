{% load static %}
<!-- ========================================== -->
<!-- ONGLET COORDONNÉES -->
<!-- ========================================== -->
<div class="tab-pane fade" id="emp_coordonnee" role="tabpanel" aria-labelledby="emp_coordonnee-tab">
    <!-- EN-TÊTE AVEC PHOTO -->
    {% if contrats %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="profile-header">
            <div class="profile-photo-container" onclick="openPhotoModal()">
                <img src="{{ employe.get_photo_url }}" alt="Photo de {{ employe.nom }} {{ employe.prenoms }}" class="profile-photo"
                     onerror="this.src='{% static 'assets/img/default_male_avatar.png' %}'">
                <div class="photo-overlay">
                    <i class="bi bi-camera-fill"></i>
                </div>
            </div>
            <div class="profile-info">
                <h1>{{ employe.nom }} {{ employe.prenoms }}</h1>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ========================================== -->
    <!-- TÉLÉPHONES -->
    <!-- ========================================== -->
    <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-telephone"></i> Téléphones</h4>
            {% if contrats %}
                <button class="btn btn-light btn-sm" onclick="openTelephoneModal()">
                    <i class="bi bi-plus-circle"></i> Ajouter un téléphone
                </button>
            {% endif %}
        </div>
        <div class="card-body">
            {% if telephones %}
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Numéro</th>
                        <th>Date début validité</th>
                        <th>Date fin validité</th>
                        <th>Statut</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tel in telephones %}
                    <tr>
                        <td><i class="bi bi-phone"></i> <strong>{{ tel.numero }}</strong></td>
                        <td>{{ tel.date_debut_validite|date:"d/m/Y" }}</td>
                        <td>{{ tel.date_fin_validite|date:"d/m/Y"|default:"Actif" }}</td>
                        <td>
                            {% if not tel.date_fin_validite %}
                            <span class="badge bg-success badge-actif"><i class="bi bi-check-circle"></i> Actif</span>
                            {% else %}
                            <span class="badge bg-secondary">Inactif</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-warning"
                                    onclick="openTelephoneModal({{ tel.id }}, '{{ tel.numero }}', '{{ tel.date_debut_validite|date:"Y-m-d" }}', '{{ tel.date_fin_validite|date:"Y-m-d"|default:'' }}')"
                                    title="Modifier">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger"
                                    onclick="confirmDeleteTelephone({{ tel.id }}, '{{ tel.numero }}')"
                                    title="Supprimer">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted text-center py-3">
                <i class="bi bi-inbox"></i> Aucun téléphone enregistré
            </p>
            {% endif %}
        </div>
    </div>

    <!-- ========================================== -->
    <!-- EMAILS -->
    <!-- ========================================== -->
    <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-envelope"></i> Emails</h4>
            {% if contrats %}
                <button class="btn btn-light btn-sm" onclick="openEmailModal()">
                    <i class="bi bi-plus-circle"></i> Ajouter un email
                </button>
            {% endif %}
        </div>
        <div class="card-body">
            {% if emails %}
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Adresse email</th>
                    <th>Date début validité</th>
                    <th>Date fin validité</th>
                    <th>Statut</th>
                    <th class="text-center">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for email in emails %}
                <tr>
                    <td><i class="bi bi-envelope-at"></i> <strong>{{ email.email }}</strong></td>
                    <td>{{ email.date_debut_validite|date:"d/m/Y" }}</td>
                    <td>{{ email.date_fin_validite|date:"d/m/Y"|default:"Actif" }}</td>
                    <td>
                        {% if not email.date_fin_validite %}
                        <span class="badge bg-success badge-actif"><i class="bi bi-check-circle"></i> Actif</span>
                        {% else %}
                        <span class="badge bg-secondary">Inactif</span>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-warning"
                                onclick="openEmailModal({{ email.id }}, '{{ email.email }}', '{{ email.date_debut_validite|date:"Y-m-d" }}', '{{ email.date_fin_validite|date:"Y-m-d"|default:'' }}')"
                                title="Modifier">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger"
                                onclick="confirmDeleteEmail({{ email.id }}, '{{ email.email }}')"
                                title="Supprimer">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted text-center py-3">
                <i class="bi bi-inbox"></i> Aucun email enregistré
            </p>
            {% endif %}
        </div>
    </div>

    <!-- ========================================== -->
    <!-- ADRESSES -->
    <!-- ========================================== -->
    <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-geo-alt"></i> Adresses</h4>
            {% if contrats %}
                <button class="btn btn-light btn-sm" onclick="openAdresseModal()">
                    <i class="bi bi-plus-circle"></i> Ajouter une adresse
                </button>
            {% endif %}
        </div>
        <div class="card-body">
            {% if adresses %}
            <div class="row">
                {% for adresse in adresses %}
                <div class="col-md-6 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="mb-0">
                                    {% if adresse.type_adresse == 'PRINCIPALE' %}
                                    <span class="badge bg-primary">
                                        <i class="bi bi-star-fill"></i> Principale
                                    </span>
                                    {% else %}
                                    <span class="badge bg-secondary">Secondaire</span>
                                    {% endif %}
                                    {% if not adresse.date_fin %}
                                    <span class="badge bg-success badge-actif ms-1">
                                        <i class="bi bi-check-circle"></i> Active
                                    </span>
                                    {% else %}
                                    <span class="badge bg-secondary ms-1">Inactive</span>
                                    {% endif %}
                                </h6>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-warning"
                                            onclick="openAdresseModal({{ adresse.id }}, '{{ adresse.rue|escapejs }}', '{{ adresse.ville }}', '{{ adresse.pays }}', '{{ adresse.code_postal }}', '{{ adresse.type_adresse }}', '{{ adresse.date_debut|date:"Y-m-d" }}', '{{ adresse.date_fin|date:"Y-m-d"|default:'' }}')"
                                            title="Modifier">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-danger"
                                            onclick="confirmDeleteAdresse({{ adresse.id }}, '{{ adresse.ville }}', '{{ adresse.get_type_adresse_display }}')"
                                            title="Supprimer">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <hr>
                            <p class="mb-1"><i class="bi bi-house-door"></i> <strong>{{ adresse.rue }}</strong></p>
                            <p class="mb-1"><i class="bi bi-geo"></i> {{ adresse.code_postal }} {{ adresse.ville }}</p>
                            <p class="mb-1"><i class="bi bi-globe"></i> {{ adresse.pays }}</p>
                            <hr>
                            <small class="text-muted">
                                <i class="bi bi-calendar"></i>
                                Du {{ adresse.date_debut|date:"d/m/Y" }}
                                {% if adresse.date_fin %}
                                au {{ adresse.date_fin|date:"d/m/Y" }}
                                {% else %}
                                à aujourd'hui
                                {% endif %}
                            </small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted text-center py-3">
                <i class="bi bi-inbox"></i> Aucune adresse enregistrée
            </p>
            {% endif %}
        </div>
    </div>
</div>
<!-- FIN ONGLET COORDONNÉES -->