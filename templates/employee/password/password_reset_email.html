{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'assets/img/logo/Onian-EasyM.png' %}">
    <style>
        body {
            background:
                linear-gradient(135deg, rgba(28, 93, 95, 0.6) 0%, rgba(69, 97, 98, 0.6) 100%),
                url('{% static "assets/img/logo/backgroud.jpg" %}') center/cover no-repeat;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #1c5d5f 0%, #456162 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 10px 10px 0 0;
        }
        .content {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 0 0 10px 10px;
        }
        .button {
            display: inline-block;
            background: linear-gradient(135deg, #1c5d5f 0%, #456162 100%);
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            margin: 20px 0;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 12px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ONIAN-EasyM</h1>
        <p>Système de Gestion des Employés</p>
    </div>

    <div class="content">
        <h2>Réinitialisation de votre mot de passe</h2>

        <p>Bonjour {% if employe %}{{ employe.prenoms }} {{ employe.nom }}{% else %}{{ user.username }}{% endif %},</p>

        <p>Vous avez demandé la réinitialisation de votre mot de passe pour votre compte ONIAN-EasyM.</p>

        <p>Cliquez sur le bouton ci-dessous pour créer un nouveau mot de passe :</p>

        <div style="text-align: center;">
            <a href="{{ reset_url }}" class="button">Réinitialiser mon mot de passe</a>
        </div>

        <p>Si le bouton ne fonctionne pas, vous pouvez copier-coller le lien suivant dans votre navigateur :</p>
        <p style="word-break: break-all; background: white; padding: 10px; border-radius: 5px; font-size: 12px;">
            {{ reset_url }}
        </p>

        <p><strong>Important :</strong> Ce lien expirera dans 24 heures pour des raisons de sécurité.</p>

        <p>Si vous n'êtes pas à l'origine de cette demande, veuillez ignorer cet email.</p>

        <p>Cordialement,<br>L'équipe ONIAN-EasyM</p>
    </div>

    <div class="footer">
        <p>© 2024 ONIAN-EasyM - Tous droits réservés</p>
        <p>Cet email a été envoyé automatiquement, merci de ne pas y répondre.</p>
    </div>

<script>
        // Empêcher la double soumission et avertir avant de quitter avec des modifications non sauvegardées
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('embauche-form');
            const submitButton = document.getElementById('submit-btn');
            let formModified = false;

            // Détecter les modifications du formulaire
            const formInputs = form.querySelectorAll('input, select, textarea');
            formInputs.forEach(input => {
                input.addEventListener('change', function() {
                    formModified = true;
                });
                input.addEventListener('input', function() {
                    formModified = true;
                });
            });

            // Empêcher la double soumission
            form.addEventListener('submit', function(e) {
                // Marquer que le formulaire est en cours de soumission
                formModified = false;

                // Désactiver le bouton et afficher un spinner
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Enregistrement en cours...';

                // Si la validation HTML5 échoue, réactiver le bouton après un court délai
                setTimeout(function() {
                    if (!form.checkValidity()) {
                        submitButton.disabled = false;
                        submitButton.innerHTML = '<i class="bi bi-check-circle"></i> Valider la pré-embauche';
                    }
                }, 100);
            });

            // Avertir avant de quitter si des modifications non sauvegardées
            window.addEventListener('beforeunload', function(e) {
                if (formModified) {
                    e.preventDefault();
                    e.returnValue = 'Vous avez des modifications non enregistrées. Voulez-vous vraiment quitter cette page ?';
                    return e.returnValue;
                }
            });

            // Auto-hide success messages after 5 seconds
            setTimeout(function() {
                var alerts = document.querySelectorAll('.alert-success');
                alerts.forEach(function(alert) {
                    var bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                });
            }, 5000);
        });


        // Empêcher la re-soumission du formulaire lors de l'actualisation
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }
    </script>
</body>
</html>