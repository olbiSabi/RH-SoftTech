{% extends 'base/baseSansMatricule.html' %}
{% load static %}
{% block extrastylet %}
<link rel="stylesheet" href="{% static 'assets/css/project_management/client.css' %}">
{% endblock %}

{% block pageContent %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="pm-page-header">
        <div class="pm-breadcrumb">
            <a href="{% url 'pm:client_list' %}"><i class="fas fa-building"></i> Clients</a>
            <i class="fas fa-chevron-right" style="font-size: 0.7rem;"></i>
            <span>{% if form.instance.pk %}Modifier {{ form.instance.raison_sociale }}{% else %}Nouveau client{% endif %}</span>
        </div>
        <h1>
            <i class="fas fa-{% if form.instance.pk %}edit{% else %}plus-circle{% endif %}"></i>
            {% if form.instance.pk %}Modifier le client{% else %}Créer un nouveau client{% endif %}
        </h1>
    </div>

    <form method="post">
        {% csrf_token %}

        <div class="pm-card">
            <div class="pm-card-header">
                <h2><i class="fas fa-building"></i> Informations générales</h2>
            </div>
            <div class="pm-card-body">
                <div class="pm-form-grid">
                    <div class="pm-form-group full-width">
                        <label for="id_raison_sociale">Raison sociale <span class="required">*</span></label>
                        {{ form.raison_sociale }}
                        {% if form.raison_sociale.errors %}
                            <div class="pm-form-error">{{ form.raison_sociale.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="pm-form-group">
                        <label for="id_contact_principal">Contact principal</label>
                        {{ form.contact_principal }}
                        {% if form.contact_principal.errors %}
                            <div class="pm-form-error">{{ form.contact_principal.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="pm-form-group">
                        <label for="id_statut">Statut</label>
                        {{ form.statut }}
                    </div>
                </div>
            </div>
        </div>

        <div class="pm-card">
            <div class="pm-card-header">
                <h2><i class="fas fa-address-card"></i> Coordonnées</h2>
            </div>
            <div class="pm-card-body">
                <div class="pm-form-grid">
                    <div class="pm-form-group">
                        <label for="id_email_contact">Email</label>
                        {{ form.email_contact }}
                        {% if form.email_contact.errors %}
                            <div class="pm-form-error">{{ form.email_contact.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="pm-form-group">
                        <label for="id_telephone_contact">Téléphone</label>
                        {{ form.telephone_contact }}
                        {% if form.telephone_contact.errors %}
                            <div class="pm-form-error">{{ form.telephone_contact.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="pm-form-group full-width">
                        <label for="id_adresse">Adresse</label>
                        {{ form.adresse }}
                    </div>

                    <div class="pm-form-group">
                        <label for="id_code_postal">Code postal</label>
                        {{ form.code_postal }}
                    </div>

                    <div class="pm-form-group">
                        <label for="id_ville">Ville</label>
                        {{ form.ville }}
                    </div>

                    <div class="pm-form-group">
                        <label for="id_pays">Pays</label>
                        {{ form.pays }}
                    </div>
                </div>
            </div>
        </div>

        <div class="pm-card">
            <div class="pm-card-header">
                <h2><i class="fas fa-file-invoice"></i> Informations fiscales et paiement</h2>
            </div>
            <div class="pm-card-body">
                <div class="pm-form-grid">
                    <div class="pm-form-group">
                        <label for="id_numero_tva">Numéro TVA</label>
                        {{ form.numero_tva }}
                    </div>

                    <div class="pm-form-group full-width">
                        <label for="id_conditions_paiement">Conditions de paiement</label>
                        {{ form.conditions_paiement }}
                    </div>
                </div>
            </div>
        </div>

        <div class="pm-form-actions">
            <a href="{% if form.instance.pk %}{% url 'pm:client_detail' form.instance.pk %}{% else %}{% url 'pm:client_list' %}{% endif %}" class="pm-btn pm-btn-secondary pm-btn-lg">
                <i class="fas fa-times"></i> Annuler
            </a>
            <button type="submit" class="pm-btn pm-btn-primary pm-btn-lg">
                <i class="fas fa-save"></i> {% if form.instance.pk %}Enregistrer{% else %}Créer le client{% endif %}
            </button>
        </div>
    </form>
</div>

{% endblock %}

{% block extrascript %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.pm-card-body input, .pm-card-body textarea, .pm-card-body select').forEach(function(el) {
            if (!el.classList.contains('pm-form-control')) {
                el.classList.add('pm-form-control');
            }
        });
    });
</script>
{% endblock %}