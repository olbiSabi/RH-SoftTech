{% load static %}
{% load gac_permissions %}
<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="header-left">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo-left">
                <a href="{% url 'dashboard' %}" class="logo">
                    <img src="{% static 'assets/img/logo/Onian-EasyM.png' %}" width="50" height="50" alt="">
                </a>
            </div>
            <!--<div class="page-title-box">
                <h3>EasyM</h3>
            </div>-->
            <!-- Menu Horizontal -->
            <nav class="horizontal-menu">
                <ul class="menu-list">

                    <!-- ========================================
                         MENU SALARIÉS
                         Visible pour : DRH, GESTION_APP, ASSISTANT_RH
                         ======================================== -->
                    {% if user.is_authenticated and user.employe %}
                        {% if user.employe.peut_gerer_employes or user.is_superuser or user.is_staff %}
                        <li class="menu-item">
                            <a href="#" class="menu-link">
                                <i class="fas fa-users"></i>
                                <span>Salariés</span>
                                <i class="fas fa-chevron-down menu-arrow"></i>
                            </a>
                            <ul class="submenu">
                                <!-- Embaucher agent : DRH/GESTION_APP/Admin uniquement -->
                                {% if user.employe.peut_embaucher or user.is_superuser or user.is_staff %}
                                <li>
                                    <a href="{% url 'employee:embauche_agent' %}">
                                        <i class="fas fa-file-contract"></i>Embaucher agent
                                    </a>
                                </li>
                                {% endif %}

                                <!-- Liste agents : DRH/GESTION_APP/Admin uniquement -->
                                {% if user.employe.peut_embaucher or user.is_superuser or user.is_staff %}
                                <li>
                                    <a href="{% url 'employee:liste_employes' %}">
                                        <i class="fas fa-clipboard-check"></i>Liste agents
                                    </a>
                                </li>
                                {% endif %}

                                <!-- Dossier individuel : Tous les rôles RH (y compris Assistant RH) -->
                                <li>
                                    <a href="{% url 'employee:dossier_individuel' %}">
                                        <i class="fas fa-check-circle"></i>Dossier individuel
                                    </a>
                                </li>
                            </ul>
                        </li>
                        {% endif %}
                    {% endif %}

                    <!-- ========================================
                        MENU ABSENCE
                        Visible pour : Tout le monde
                    ======================================== -->
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Absence</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <!-- Acquisition congé : DRH, GESTION_APP uniquement -->
                            {% if user.is_authenticated and user.employe %}
                                {% if user.employe.peut_embaucher or user.employe.peut_gerer_parametrage_app or user.is_superuser %}
                                <li>
                                    <a href="{% url 'absence:liste_acquisitions' %}">
                                        <i class="fas fa-calendar-check"></i>Acquisition congé
                                    </a>
                                </li>
                                {% endif %}
                            {% endif %}

                            <!-- Demande d'absence : Visible pour tout le monde -->
                            <li>
                                <a href="{% url 'absence:liste_absences' %}">
                                    <i class="fas fa-calendar-plus"></i>Demande d'absence
                                </a>
                            </li>

                            <!-- Validation manager : MANAGER_ABS + Managers de département -->
                            {% if user.employe.est_manager_departement %}
                            <li>
                                <a href="{% url 'absence:validation_manager' %}">
                                    <i class="fas fa-user-check"></i>Validation manager
                                </a>
                            </li>
                            {% endif %}

                            <!-- Validation RH : RH_VALIDATION_ABS, DRH, GESTION_APP -->
                            {% if user.employe.peut_valider_absence_rh %}
                            <li>
                                <a href="{% url 'absence:validation_rh' %}">
                                    <i class="fas fa-user-shield"></i>Validation RH
                                </a>
                            </li>
                            {% endif %}

                            <!-- Consultation absences : ASSISTANT_RH, RH_VALIDATION_ABS, DRH, GESTION_APP -->
                            {% if user.employe.est_assistant_rh or user.employe.peut_valider_absence_rh or user.employe.peut_gerer_parametrage_app %}
                            <li>
                                <a href="{% url 'absence:consultation_absences' %}">
                                    <i class="fas fa-eye"></i>Consulter absences
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </li>

                    <!-- ========================================
                    MENU PROJECT MANAGEMENT
                    Permissions:
                    - Clients: RESP_ADMIN, DRH, GESTION_APP, DIRECTEUR
                    - Projets: MANAGER, RESP_ADMIN, DRH, GESTION_APP, DIRECTEUR (ou tous pour voir)
                    - Validation/Rapports/Export: MANAGER, RESP_ADMIN, DRH, GESTION_APP, DIRECTEUR
                    ======================================== -->
                {% if user.is_authenticated and user.employe %}
                    <li class="menu-item">
                        <a href="{% url 'pm:dashboard' %}" class="menu-link">
                            <i class="fas fa-project-diagram"></i>
                            <span>Projets</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <!-- Dashboard - Accessible à tous -->
                            <li>
                                <a href="{% url 'pm:dashboard' %}">
                                    <i class="fas fa-tachometer-alt"></i> Tableau de bord
                                </a>
                            </li>

                            <!-- Clients - RESP_ADMIN, DRH, GESTION_APP, DIRECTEUR uniquement -->
                            {% if user.employe.peut_gerer_clients or user.is_superuser or user.is_staff %}
                            <li>
                                <a href="{% url 'pm:client_list' %}">
                                    <i class="fas fa-building"></i> Clients
                                </a>
                            </li>
                            {% endif %}

                            <!-- Projets - Accessible à tous (création/modif restreinte) -->
                            <li>
                                <a href="{% url 'pm:projet_list' %}">
                                    <i class="fas fa-folder-open"></i> Projets
                                </a>
                            </li>

                            <!-- Tickets - Accessible à tous -->
                            <li>
                                <a href="{% url 'pm:ticket_list' %}">
                                    <i class="fas fa-tasks"></i> Tickets
                                </a>
                            </li>

                            <!-- Sprints - Accessible à tous -->
                            <li>
                                <a href="{% url 'pm:sprint_list' %}">
                                    <i class="fas fa-running"></i> Sprints
                                </a>
                            </li>

                            <!-- Imputations - Accessible à tous -->
                            <li>
                                <a href="{% url 'pm:imputation_list' %}">
                                    <i class="fas fa-user-clock"></i> Imputations
                                </a>
                            </li>

                            <!-- Backlog - Accessible à tous -->
                            <li>
                                <a href="{% url 'pm:backlog_list' %}">
                                    <i class="fas fa-list"></i> Backlog
                                </a>
                            </li>

                            <li class="submenu-divider"></li>

                            <!-- Mes imputations - Accessible à tous -->
                            <li>
                                <a href="{% url 'pm:mes_imputations' %}">
                                    <i class="fas fa-clock"></i> Mes temps
                                </a>
                            </li>

                            <!-- Nouvelle imputation - Accessible à tous -->
                            <li>
                                <a href="{% url 'pm:imputation_create' %}">
                                    <i class="fas fa-plus-circle"></i> Saisir du temps
                                </a>
                            </li>

                            <!-- Validation, Rapports, Export - MANAGER, RESP_ADMIN, DRH, GESTION_APP, DIRECTEUR -->
                            {% if user.employe.peut_voir_toutes_imputations or user.is_superuser or user.is_staff %}
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'pm:validation_imputations' %}">
                                    <i class="fas fa-check-double"></i> Validation
                                </a>
                            </li>

                            <!-- Rapports -->
                            <li>
                                <a href="{% url 'pm:rapports_temps' %}">
                                    <i class="fas fa-chart-bar"></i> Rapports
                                </a>
                            </li>

                            <!-- Export -->
                            <li>
                                <a href="{% url 'pm:export_temps_excel' %}">
                                    <i class="fas fa-file-excel"></i> Export Excel
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </li>
                {% endif %}

                    <!-- ========================================
                        MENU FRAIS
                        Visible pour : Tous les employés
                    ======================================== -->
                {% if user.is_authenticated and user.employe %}
                    <li class="menu-item">
                        <a href="{% url 'frais:dashboard' %}" class="menu-link">
                            <i class="fas fa-receipt"></i>
                            <span>Frais</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li>
                                <a href="{% url 'frais:creer_note' %}">
                                    <i class="fas fa-plus-circle"></i> Nouvelle note
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'frais:liste_notes' %}">
                                    <i class="fas fa-file-invoice"></i> Mes notes
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'frais:liste_avances' %}">
                                    <i class="fas fa-hand-holding-usd"></i> Mes avances
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'frais:creer_avance' %}">
                                    <i class="fas fa-money-bill-wave"></i> Demander avance
                                </a>
                            </li>

                            {% if user.employe.peut_valider_frais %}
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'frais:notes_a_valider' %}">
                                    <i class="fas fa-check-circle"></i> Notes à valider
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'frais:avances_a_approuver' %}">
                                    <i class="fas fa-user-check"></i> Avances à approuver
                                </a>
                            </li>
                            {% endif %}

                            {% if user.employe.peut_rembourser_frais %}
                            <li>
                                <a href="{% url 'frais:notes_a_rembourser' %}">
                                    <i class="fas fa-money-check-alt"></i> À rembourser
                                </a>
                            </li>
                            {% endif %}

                            {% if user.employe.peut_administrer_frais %}
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'frais:admin_notes_validees' %}">
                                    <i class="fas fa-file-invoice-dollar"></i> Notes validées
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'frais:admin_avances_approuvees' %}">
                                    <i class="fas fa-hand-holding-usd"></i> Avances approuvées
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'frais:admin_remboursements' %}">
                                    <i class="fas fa-money-bill-wave"></i> Remboursements
                                </a>
                            </li>
                            {% endif %}

                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'frais:statistiques' %}">
                                    <i class="fas fa-chart-bar"></i> Statistiques
                                </a>
                            </li>
                        </ul>
                    </li>
                {% endif %}

                    <!-- ========================================
                        MENU MATÉRIEL
                        Visible pour : DRH, GESTION_APP, RESP_ADMIN, ASSISTANT_RH et tous (mon matériel)
                    ======================================== -->
                {% if user.is_authenticated and user.employe %}
                    <li class="menu-item">
                        <a href="{% url 'materiel:dashboard' %}" class="menu-link">
                            <i class="fas fa-boxes"></i>
                            <span>Matériel</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <!-- Mon matériel : Visible pour tous -->
                            <li>
                                <a href="{% url 'materiel:mon_materiel' %}">
                                    <i class="fas fa-laptop"></i> Mon matériel
                                </a>
                            </li>

                            {% if user.employe.peut_gerer_materiel or user.employe.peut_affecter_materiel %}
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'materiel:liste_materiels' %}">
                                    <i class="fas fa-list"></i> Liste matériels
                                </a>
                            </li>
                            {% endif %}

                            {% if user.employe.peut_gerer_materiel %}
                            <li>
                                <a href="{% url 'materiel:creer_materiel' %}">
                                    <i class="fas fa-plus-circle"></i> Nouveau matériel
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'materiel:liste_maintenances' %}">
                                    <i class="fas fa-tools"></i> Maintenances
                                </a>
                            </li>
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'materiel:liste_categories' %}">
                                    <i class="fas fa-layer-group"></i> Catégories
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'materiel:liste_fournisseurs' %}">
                                    <i class="fas fa-truck"></i> Fournisseurs
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </li>
                {% endif %}

                    <!-- ========================================
                        MENU AUDIT
                        Visible pour : GESTION_APP, DIRECTEUR, Admin
                    ======================================== -->
                {% if user.is_authenticated and user.employe %}
                    {% if user.employe.peut_acceder_audit or user.is_superuser or user.is_staff %}
                    <li class="menu-item">
                        <a href="{% url 'audit:dashboard' %}" class="menu-link">
                            <i class="fas fa-shield-alt"></i>
                            <span>Audit</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li>
                                <a href="{% url 'audit:dashboard' %}">
                                    <i class="fas fa-tachometer-alt"></i> Tableau de bord
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'audit:liste_alertes' %}">
                                    <i class="fas fa-exclamation-triangle"></i> Alertes
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'audit:liste_logs' %}">
                                    <i class="fas fa-history"></i> Logs système
                                </a>
                            </li>
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'audit:liste_rapports' %}">
                                    <i class="fas fa-file-alt"></i> Rapports
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'audit:generer_rapport' %}">
                                    <i class="fas fa-file-export"></i> Générer rapport
                                </a>
                            </li>
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'audit:liste_regles' %}">
                                    <i class="fas fa-cogs"></i> Règles de conformité
                                </a>
                            </li>
                        </ul>
                    </li>
                    {% endif %}
                {% endif %}

                    <!-- ========================================
                        MENU ACHATS (GAC)
                        Permissions basées sur les rôles GAC
                    ======================================== -->
                {% if user.is_authenticated and user.employe %}
                    <li class="menu-item">
                        <a href="{% url 'gestion_achats:dashboard' %}" class="menu-link">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Achats</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <!-- Dashboard - Accessible à tous -->
                            <li>
                                <a href="{% url 'gestion_achats:dashboard' %}">
                                    <i class="fas fa-tachometer-alt"></i> Tableau de bord
                                </a>
                            </li>

                            <li class="submenu-divider"></li>

                            <!-- Mes demandes - Accessible à tous -->
                            <li>
                                <a href="{% url 'gestion_achats:mes_demandes' %}">
                                    <i class="fas fa-file-alt"></i> Mes demandes
                                </a>
                            </li>

                            <!-- Nouvelle demande - Accessible à tous -->
                            <li>
                                <a href="{% url 'gestion_achats:demande_create' %}">
                                    <i class="fas fa-plus-circle"></i> Nouvelle demande
                                </a>
                            </li>

                            <!-- Demandes à valider - VALIDATEUR_N1, VALIDATEUR_N2, ADMIN_GAC -->
                            {% can_validate_gac user as can_validate %}
                            {% if can_validate %}
                            <li>
                                <a href="{% url 'gestion_achats:demandes_a_valider' %}">
                                    <i class="fas fa-check-circle"></i> Demandes à valider
                                </a>
                            </li>
                            {% endif %}

                            <!-- Toutes les demandes - ACHETEUR, ADMIN_GAC -->
                            {% can_view_all_demandes user as can_view_all %}
                            {% if can_view_all %}
                            <li>
                                <a href="{% url 'gestion_achats:demande_liste' %}">
                                    <i class="fas fa-list"></i> Toutes les demandes
                                </a>
                            </li>
                            {% endif %}

                            <!-- Bons de commande - ACHETEUR, RECEPTIONNAIRE, ADMIN_GAC -->
                            {% can_manage_bons_commande user as can_manage_bc %}
                            {% if can_manage_bc %}
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="{% url 'gestion_achats:bon_commande_liste' %}">
                                    <i class="fas fa-file-invoice"></i> Bons de commande
                                </a>
                            </li>
                            {% endif %}

                            <!-- Budgets - GESTIONNAIRE_BUDGET, ADMIN_GAC -->
                            {% can_manage_budgets user as can_manage_budgets %}
                            {% if can_manage_budgets %}
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="#" style="pointer-events: none; opacity: 0.6; cursor: not-allowed;">
                                    <i class="fas fa-wallet"></i> Budgets (À venir)
                                </a>
                            </li>
                            {% endif %}

                            <!-- Administration - ADMIN_GAC uniquement -->
                            {% is_admin_gac user as is_admin %}
                            {% if is_admin %}
                            <li class="submenu-divider"></li>
                            <li>
                                <a href="#" style="pointer-events: none; opacity: 0.6; cursor: not-allowed;">
                                    <i class="fas fa-box"></i> Articles (À venir)
                                </a>
                            </li>
                            <li>
                                <a href="#" style="pointer-events: none; opacity: 0.6; cursor: not-allowed;">
                                    <i class="fas fa-truck"></i> Fournisseurs (À venir)
                                </a>
                            </li>
                            <li>
                                <a href="#" style="pointer-events: none; opacity: 0.6; cursor: not-allowed;">
                                    <i class="fas fa-tags"></i> Catégories (À venir)
                                </a>
                            </li>
                            <li>
                                <a href="#" style="pointer-events: none; opacity: 0.6; cursor: not-allowed;">
                                    <i class="fas fa-dolly"></i> Réceptions (À venir)
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </li>
                {% endif %}

                    <!-- ========================================
                       MENU PARAMÈTRES
                       Visible UNIQUEMENT pour : DRH, GESTION_APP, Admin
                    ======================================== -->
                    {% if user.is_authenticated and user.employe %}
                    {% if user.employe.peut_embaucher or user.employe.peut_gerer_parametrage_app or user.is_superuser or user.employe.est_assistant_rh%}
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-cog"></i>
                            <span>Paramètres</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <!-- Département : DRH, GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'departement:list' %}">
                                    <i class="fas fa-briefcase"></i>Département
                                </a>
                            </li>

                            <!-- Poste : DRH, GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'departement:poste_list' %}">
                                    <i class="fas fa-id-card"></i>Poste
                                </a>
                            </li>
                            <!-- Managers : DRH, GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'departement:liste_managers' %}">
                                    <i class="fas fa-user-tie"></i>Managers
                                </a>
                            </li>

                            <!-- ====== SECTION RÉSERVÉE GESTION_APP ====== -->
                            {% if user.employe.peut_gerer_parametrage_app or user.is_superuser %}

                            <!-- Entreprise : GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'entreprise:profil_entreprise' %}">
                                    <i class="fas fa-building"></i>Entreprise
                                </a>
                            </li>
                            <!-- Gestion de rôles : GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'employee:gestion_roles' %}">
                                    <i class="fas fa-user-shield"></i>Gestion de rôles
                                </a>
                            </li>
                            <!-- Type d'absence : GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'absence:liste_types_absence' %}">
                                    <i class="fas fa-calendar-times"></i>Type d'absence
                                </a>
                            </li>

                            <!-- Conventions : GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'absence:liste_conventions' %}">
                                    <i class="fas fa-umbrella-beach"></i>Conventions
                                </a>
                            </li>
                            <!-- Jours fériés : GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'absence:liste_jours_feries' %}">
                                    <i class="fas fa-calendar-day"></i>Jours fériés
                                </a>
                            </li>
                            <!-- Paramètres calculs : GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'absence:liste_parametres_calcul' %}">
                                    <i class="fas fa-calculator"></i>Paramètres calculs
                                </a>
                            </li>
                            <!-- Catégories de frais : GESTION_APP uniquement -->
                            <li>
                                <a href="{% url 'frais:liste_categories' %}">
                                    <i class="fas fa-tags"></i>Catégories de frais
                                </a>
                            </li>

                            {% endif %}
                        </ul>
                    </li>
                    {% endif %} {% endif %}
                </ul>
            </nav>
        </div>
        <div class="header-right">
            <!-- ✅ NOTIFICATIONS -->
            {% if user.is_authenticated %}
            <div class="notifications-dropdown">
                <button class="notifications-btn" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                    {% if notifications_count > 0 %}
                    <span class="notifications-badge">{{ notifications_count }}</span>
                    {% endif %}
                </button>

                <div class="notifications-menu" id="notificationsMenu">
                    <div class="notifications-header">
                        <h4>Notifications</h4>
                        {% if notifications_count > 0 %}
                        <div class="mark-all-container">
                            <a href="{% url 'absence:marquer_toutes_lues' %}" class="mark-all-read">
                                Marquer tout lu
                            </a>
                        </div>
                        {% endif %}
                    </div>

                    <!-- ✅ LISTE DES NOTIFICATIONS UNIFIÉE -->
                    <div class="notifications-list">
                        {% for notif in notifications %}
                        <a href="{{ notif.get_url }}"
                           class="notification-item {% if not notif.lue %}unread{% endif %}"
                           data-notification-id="{{ notif.id }}">
                            <div class="notification-icon">
                                <!-- Icône selon le type de notification -->
                                {% if notif.type_notification == 'TICKET_ASSIGNE' or notif.type_notification == 'PROJET_ASSIGNE' %}
                                <i class="fas fa-user-plus"></i>
                                {% elif notif.type_notification == 'TICKET_REASSIGNE' or notif.type_notification == 'PROJET_REASSIGNE' %}
                                <i class="fas fa-exchange-alt"></i>
                                {% elif notif.type_notification == 'STATUT_TICKET_CHANGE' or notif.type_notification == 'STATUT_PROJET_CHANGE' %}
                                <i class="fas fa-sync-alt"></i>
                                {% elif notif.type_notification == 'ECHEANCE_PROCHE' %}
                                <i class="fas fa-clock"></i>
                                {% elif notif.type_notification == 'COMMENTAIRE_TICKET' %}
                                <i class="fas fa-comment"></i>
                                {% elif notif.type_notification == 'DEMANDE_CREEE' or notif.type_notification == 'DEMANDE_VALIDEE_MANAGER' %}
                                <i class="fas fa-plus-circle"></i>
                                {% elif 'VALIDATION' in notif.type_notification %}
                                <i class="fas fa-check-circle"></i>
                                {% elif 'REJET' in notif.type_notification %}
                                <i class="fas fa-times-circle"></i>
                                {% elif notif.type_notification == 'ABSENCE_ANNULEE' %}
                                <i class="fas fa-ban"></i>
                                {% elif notif.contexte == 'MANAGER' %}
                                <i class="fas fa-user-tie"></i>
                                {% elif notif.contexte == 'RH' %}
                                <i class="fas fa-user-shield"></i>
                                {% else %}
                                <i class="fas fa-bell"></i>
                                {% endif %}
                            </div>
                            <div class="notification-content">
                                <div class="notification-message">
                                    {{ notif.message }}
                                </div>
                                <div class="notification-time">
                                    {{ notif.date_creation|timesince }}
                                </div>
                            </div>
                            {% if not notif.lue %}
                            <button class="notification-mark-read" title="Marquer comme lu">
                                <i class="fas fa-check"></i>
                            </button>
                            {% endif %}
                        </a>
                        {% empty %}
                        <div class="notification-empty">
                            <i class="fas fa-bell-slash"></i>
                            <p>Aucune notification</p>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="notifications-footer">
                        <a href="{% url 'absence:toutes_notifications' %}" class="notification-see-all">
                            <i class="fas fa-history"></i> Historique complet
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- User Info -->
            <div class="user-info">
                {% if user.is_authenticated %}
                <ul class="menu-list">
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            {% if user.employe %}
                            <img src="{{ user.employe.get_photo_url }}"
                                 alt="{{ user.employe.username }}"
                                 class="user-avatar"
                                 style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
                            {% else %}
                            <i class="fas fa-user-circle"></i>
                            {% endif %}
                            <span>
                                {% if user.employe %}
                                    {{ user.employe.username }} {{ user.employe.prenomuser }}
                                {% else %}
                                    {{ user.get_full_name|default:user.username }}
                                {% endif %}
                            </span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li>
                                <a href="{% url 'employee:profil' request.user.employe.matricule %}">
                                    <i class="fas fa-user-circle"></i> Mon Profil
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'change_password' %}">
                                    <i class="fas fa-key"></i> Changer mot de passe
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'logout' %}">
                                    <i class="fas fa-power-off"></i> Déconnexion
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                {% else %}
                <a href="{% url 'login' %}" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Connexion
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</header>

<!-- Overlay pour fermer le sidebar sur mobile -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>