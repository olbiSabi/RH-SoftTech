{% load static %}
<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="header-left">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo-left">
                <a href="{% url 'dashboard' %}" class="logo">
                    <img src="{% static 'assets/img/logo/Onian-EasyM.png' %}" width="50" height="50" alt="">
                </a>
            </div>
            <div class="page-title-box">
                <h3>EasyM</h3>
            </div>
            <!-- Menu Horizontal -->
            <nav class="horizontal-menu">
                <ul class="menu-list">
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-users"></i>
                            <span>Salariés</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li><a href="{% url 'embauche_agent' %}"><i class="fas fa-file-contract"></i>Embaucher agent</a></li>
                            <li><a href="{% url 'liste_employes' %}"><i class="fas fa-clipboard-check"></i>Liste agents</a></li>
                            <li><a href="{% url 'dossier_individuel' %}"><i class="fas fa-check-circle"></i>dossier individuel</a></li>
                            <li><a href="{% url 'absence:employe_demandes' %}"><i class="fas fa-umbrella-beach"></i>Demande de congé</a></li>
                            <li><a href="{% url 'absence:manager_validation' %}"><i class="fas fa-clipboard-check"></i>Validation de congé</a></li>
                        </ul>
                    </li>

                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-chart-bar"></i>
                            <span>Rapports</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li><a href="#"><i class="fas fa-file-alt"></i> Rapport mensuel</a></li>
                            <li><a href="#"><i class="fas fa-chart-pie"></i> Statistiques</a></li>
                            <li><a href="#"><i class="fas fa-calendar-alt"></i> Rapport annuel</a></li>
                        </ul>
                    </li>

                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-cog"></i>
                            <span>Paramètres</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li><a href="{% url 'list' %}"><i class="fas fa-briefcase"></i>Département</a></li>
                            <li><a href="{% url 'poste_list' %}"><i class="fas fa-id-card"></i>Poste</a></li>
                            <li><a href="{% url 'absence_list' %}"><i class="fas fa-plane"></i>Type d'absence</a></li>
                            <li><a href="{% url 'liste_managers' %}"><i class="fas fa-user-tie"></i> managers</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="header-right">
            <!-- NOTIFICATION BELL - NOUVEAU -->
            {% if user.is_authenticated %}
                {% if demandes_en_attente_count > 0 or demandes_rh_count > 0 %}
                <div class="notification-wrapper" style="margin-right: 20px;">
                    <button class="notification-bell" id="notificationBell">
                        <i class="fas fa-bell"></i>
                        {% if demandes_en_attente_count > 0 %}
                        <span class="notification-badge">{{ demandes_en_attente_count }}</span>
                        {% elif demandes_rh_count > 0 %}
                        <span class="notification-badge">{{ demandes_rh_count }}</span>
                        {% endif %}
                    </button>

                    <!-- Dropdown des notifications -->
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <h4>
                                <i class="fas fa-bell"></i> Notifications
                                <span class="notification-count">({{ demandes_en_attente_count|add:demandes_rh_count }})</span>
                            </h4>
                        </div>

                        <div class="notification-body">
                            {% if demandes_en_attente_count > 0 %}
                            <div class="notification-section">
                                <div class="notification-section-title">
                                    <i class="fas fa-user-tie"></i> En attente de validation Manager
                                </div>
                                {% for demande in demandes_en_attente %}
                                <a href="{% url 'absence:manager_validation' %}" class="notification-item">
                                    <div class="notification-icon" style="background: #fef3c7;">
                                        <i class="fas fa-umbrella-beach" style="color: #f59e0b;"></i>
                                    </div>
                                    <div class="notification-content">
                                        <div class="notification-title">
                                            {{ demande.employe.nom }} {{ demande.employe.prenoms }}
                                        </div>
                                        <div class="notification-text">
                                            {{ demande.type_absence.LIBELLE }} - {{ demande.nombre_jours }} jour{{ demande.nombre_jours|floatformat:0|pluralize }}
                                        </div>
                                        <div class="notification-date">
                                            <i class="fas fa-calendar"></i> {{ demande.date_debut|date:"d/m/Y" }} au {{ demande.date_fin|date:"d/m/Y" }}
                                        </div>
                                        <div class="notification-time">
                                            <i class="fas fa-clock"></i> {{ demande.created_at|timesince }}
                                        </div>
                                    </div>
                                </a>
                                {% endfor %}

                                <a href="{% url 'absence:manager_validation' %}" class="notification-view-all">
                                    <i class="fas fa-arrow-right"></i> Voir toutes les demandes ({{ demandes_en_attente_count }})
                                </a>
                            </div>
                            {% endif %}

                            {% if demandes_rh_count > 0 %}
                            <div class="notification-section">
                                <div class="notification-section-title">
                                    <i class="fas fa-user-shield"></i> En attente de validation RH
                                </div>
                                {% for demande in demandes_rh %}
                                <a href="{% url 'absence:rh_validation' %}" class="notification-item">
                                    <div class="notification-icon" style="background: #dbeafe;">
                                        <i class="fas fa-umbrella-beach" style="color: #3b82f6;"></i>
                                    </div>
                                    <div class="notification-content">
                                        <div class="notification-title">
                                            {{ demande.employe.nom }} {{ demande.employe.prenoms }}
                                        </div>
                                        <div class="notification-text">
                                            {{ demande.type_absence.LIBELLE }} - {{ demande.nombre_jours }} jour{{ demande.nombre_jours|floatformat:0|pluralize }}
                                        </div>
                                        <div class="notification-date">
                                            <i class="fas fa-calendar"></i> {{ demande.date_debut|date:"d/m/Y" }} au {{ demande.date_fin|date:"d/m/Y" }}
                                        </div>
                                        <div class="notification-time">
                                            <i class="fas fa-clock"></i> {{ demande.created_at|timesince }}
                                        </div>
                                    </div>
                                </a>
                                {% endfor %}

                                <a href="{% url 'absence:rh_validation' %}" class="notification-view-all">
                                    <i class="fas fa-arrow-right"></i> Voir toutes les demandes ({{ demandes_rh_count }})
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endif %}

            <div class="user-info">
                {% if user.is_authenticated %}
                <ul class="menu-list">
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            {% if user.employe %}
                            <img src="{{ user.employe.get_photo_url }}"
                                 alt="{{ user.employe.username }}"
                                 class="user-avatar"
                                 style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
                            {% else %}
                            <i class="fas fa-user-circle"></i>
                            {% endif %}
                            <span>
                    {% if user.employe %}
                        {{ user.employe.username }} {{ user.employe.prenomuser }}
                    {% else %}
                        {{ user.get_full_name|default:user.username }}
                    {% endif %}
                </span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li>
                                <a href="{% url 'profile-employee' %}">
                                    <i class="fas fa-user-circle"></i> Mon Profil
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'logout' %}">
                                    <i class="fas fa-power-off"></i> Déconnexion
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'change_password' %}">
                                    <i class="fas fa-key"></i> Change password
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                {% else %}
                <a href="{% url 'login' %}" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Connexion
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</header>

<!-- STYLES CSS POUR LES NOTIFICATIONS -->
<style>
/* Wrapper de notification */
.notification-wrapper {
    position: relative;
    display: inline-block;
}

/* Bouton cloche */
.notification-bell {
    position: relative;
    background: none;
    border: none;
    font-size: 20px;
    color: #6b7280;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.notification-bell:hover {
    background: #f3f4f6;
    color: #f59e0b;
}

/* Badge de notification */
.notification-badge {
    position: absolute;
    top: 2px;
    right: 2px;
    background: #ef4444;
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* Dropdown */
.notification-dropdown {
    position: absolute;
    top: calc(100% + 10px);
    right: 0;
    width: 400px;
    max-height: 600px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    display: none;
    z-index: 1000;
    overflow: hidden;
}

.notification-dropdown.show {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Header des notifications */
.notification-header {
    padding: 16px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-bottom: 1px solid #e5e7eb;
}

.notification-header h4 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.notification-count {
    font-size: 14px;
    opacity: 0.9;
}

/* Body des notifications */
.notification-body {
    max-height: 500px;
    overflow-y: auto;
}

.notification-body::-webkit-scrollbar {
    width: 6px;
}

.notification-body::-webkit-scrollbar-track {
    background: #f3f4f6;
}

.notification-body::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
}

/* Section */
.notification-section {
    padding: 12px 0;
    border-bottom: 1px solid #f3f4f6;
}

.notification-section:last-child {
    border-bottom: none;
}

.notification-section-title {
    padding: 8px 20px;
    font-size: 13px;
    font-weight: 600;
    color: #6b7280;
    background: #f9fafb;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Item de notification */
.notification-item {
    display: flex;
    padding: 12px 20px;
    gap: 12px;
    text-decoration: none;
    color: inherit;
    transition: background 0.2s ease;
    border-left: 3px solid transparent;
}

.notification-item:hover {
    background: #f9fafb;
    border-left-color: #f59e0b;
}

.notification-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 18px;
}

.notification-content {
    flex: 1;
    min-width: 0;
}

.notification-title {
    font-weight: 600;
    font-size: 14px;
    color: #111827;
    margin-bottom: 4px;
}

.notification-text {
    font-size: 13px;
    color: #6b7280;
    margin-bottom: 6px;
}

.notification-date {
    font-size: 12px;
    color: #9ca3af;
    margin-bottom: 2px;
}

.notification-date i,
.notification-time i {
    font-size: 10px;
    margin-right: 4px;
}

.notification-time {
    font-size: 11px;
    color: #d1d5db;
}

/* Bouton voir tout */
.notification-view-all {
    display: block;
    padding: 12px 20px;
    text-align: center;
    font-size: 13px;
    font-weight: 600;
    color: #667eea;
    text-decoration: none;
    transition: all 0.2s ease;
}

.notification-view-all:hover {
    background: #f3f4f6;
    color: #764ba2;
}

/* Message vide */
.notification-empty {
    padding: 40px 20px;
    text-align: center;
    color: #9ca3af;
}

.notification-empty i {
    font-size: 48px;
    margin-bottom: 12px;
    opacity: 0.3;
}

/* Responsive */
@media (max-width: 768px) {
    .notification-dropdown {
        width: 320px;
        right: -20px;
    }
}
</style>

<!-- JAVASCRIPT POUR LES NOTIFICATIONS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const notificationBell = document.getElementById('notificationBell');
    const notificationDropdown = document.getElementById('notificationDropdown');

    if (notificationBell && notificationDropdown) {
        // Toggle dropdown
        notificationBell.addEventListener('click', function(e) {
            e.stopPropagation();
            notificationDropdown.classList.toggle('show');
        });

        // Fermer en cliquant ailleurs
        document.addEventListener('click', function(e) {
            if (!notificationDropdown.contains(e.target) && e.target !== notificationBell) {
                notificationDropdown.classList.remove('show');
            }
        });

        // Empêcher la fermeture en cliquant dans le dropdown
        notificationDropdown.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
});
</script>

<!-- Overlay pour fermer le sidebar sur mobile -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>