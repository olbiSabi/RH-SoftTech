{% load static %}
<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="header-left">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo-left">
                <a href="{% url 'dashboard' %}" class="logo">
                    <img src="{% static 'assets/img/logo/Onian-EasyM.png' %}" width="50" height="50" alt="">
                </a>
            </div>
            <div class="page-title-box">
                <h3>EasyM</h3>
            </div>
            <!-- Menu Horizontal -->
            <nav class="horizontal-menu">
                <ul class="menu-list">
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-users"></i>
                            <span>Salari√©s</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li><a href="{% url 'embauche_agent' %}"><i class="fas fa-file-contract"></i>Embaucher agent</a></li>
                            <li><a href="{% url 'liste_employes' %}"><i class="fas fa-clipboard-check"></i>Liste agents</a></li>
                            <li><a href="{% url 'dossier_individuel' %}"><i class="fas fa-check-circle"></i>dossier individuel</a></li>
                            <li><a href="{% url 'absence:employe_demandes' %}"><i class="fas fa-umbrella-beach"></i>Demande de cong√©</a></li>
                            <li><a href="{% url 'absence:manager_validation' %}"><i class="fas fa-clipboard-check"></i>Validation de cong√©</a></li>
                            <li><a href="{% url 'absence:rh_validation' %}"><i class="fas fa-clipboard-check"></i>Validation RH</a></li>
                        </ul>
                    </li>

                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-chart-bar"></i>
                            <span>Rapports</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li><a href="#"><i class="fas fa-file-alt"></i> Rapport mensuel</a></li>
                            <li><a href="#"><i class="fas fa-chart-pie"></i> Statistiques</a></li>
                            <li><a href="#"><i class="fas fa-calendar-alt"></i> Rapport annuel</a></li>
                        </ul>
                    </li>

                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="fas fa-cog"></i>
                            <span>Param√®tres</span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li><a href="{% url 'list' %}"><i class="fas fa-briefcase"></i>D√©partement</a></li>
                            <li><a href="{% url 'poste_list' %}"><i class="fas fa-id-card"></i>Poste</a></li>
                            <li><a href="{% url 'absence_list' %}"><i class="fas fa-plane"></i>Type d'absence</a></li>
                            <li><a href="{% url 'liste_managers' %}"><i class="fas fa-user-tie"></i> managers</a></li>
                            <li><a href="{% url 'gestion_roles' %}"><i class="fas fa-crown"></i>Gestion de r√¥les</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="header-right">
            <!-- üÜï SYST√àME DE NOTIFICATIONS AM√âLIOR√â -->
            {% if user.is_authenticated %}
            <div class="notifications-container">
                <button class="notification-bell" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    {% if nb_notifications_non_lues > 0 %}
                    <span class="notification-badge">{{ nb_notifications_non_lues }}</span>
                    {% endif %}
                </button>

                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <h3><i class="fas fa-bell"></i> Notifications</h3>
                        {% if nb_notifications_non_lues > 0 %}
                        <button class="mark-all-read" id="markAllRead">
                            <i class="fas fa-check-double"></i> Tout marquer comme lu
                        </button>
                        {% endif %}
                    </div>

                    <div class="notification-list">
                        {% if notifications_non_lues %}
                            {% for notif in notifications_non_lues %}
                            <div class="notification-item {% if not notif.lue %}unread{% endif %}"
                                 data-notification-id="{{ notif.id }}"
                                 data-notification-link="{% if notif.lien %}{{ notif.lien }}{% else %}#{% endif %}">
                                <div class="notification-icon">
                                    {% if notif.type_notification == 'ABSENCE_NOUVELLE' %}
                                        <i class="fas fa-calendar-plus" style="color: #f59e0b;"></i>
                                    {% elif 'VALIDEE' in notif.type_notification %}
                                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                                    {% elif 'REJETEE' in notif.type_notification %}
                                        <i class="fas fa-times-circle" style="color: #ef4444;"></i>
                                    {% else %}
                                        <i class="fas fa-info-circle" style="color: #3b82f6;"></i>
                                    {% endif %}
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">{{ notif.titre }}</div>
                                    <div class="notification-message">{{ notif.message|truncatewords:15 }}</div>
                                    {% if notif.demande_absence %}
                                    <div class="notification-details">
                                        <i class="fas fa-calendar"></i>
                                        {{ notif.demande_absence.date_debut|date:"d/m/Y" }} - {{ notif.demande_absence.date_fin|date:"d/m/Y" }}
                                        <span class="notification-days">
                                            ({{ notif.demande_absence.nombre_jours|floatformat:0 }} jour{{ notif.demande_absence.nombre_jours|floatformat:0|pluralize }})
                                        </span>
                                    </div>
                                    {% endif %}
                                    <div class="notification-time">
                                        <i class="fas fa-clock"></i> {{ notif.date_creation|timesince }}
                                    </div>
                                </div>
                                {% if not notif.lue %}
                                <div class="notification-unread-dot"></div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="notification-empty">
                                <i class="fas fa-bell-slash"></i>
                                <p>Aucune nouvelle notification</p>
                            </div>
                        {% endif %}
                    </div>

                    {% if notifications_non_lues %}
                    <div class="notification-footer">
                        <a href="{% url 'absence:liste_notifications' %}" class="view-all-notifications">
                            <i class="fas fa-list"></i> Voir toutes les notifications
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- User Info -->
            <div class="user-info">
                {% if user.is_authenticated %}
                <ul class="menu-list">
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            {% if user.employe %}
                            <img src="{{ user.employe.get_photo_url }}"
                                 alt="{{ user.employe.username }}"
                                 class="user-avatar"
                                 style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
                            {% else %}
                            <i class="fas fa-user-circle"></i>
                            {% endif %}
                            <span>
                                {% if user.employe %}
                                    {{ user.employe.username }} {{ user.employe.prenomuser }}
                                {% else %}
                                    {{ user.get_full_name|default:user.username }}
                                {% endif %}
                            </span>
                            <i class="fas fa-chevron-down menu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li>
                                <a href="{% url 'profile-employee' %}">
                                    <i class="fas fa-user-circle"></i> Mon Profil
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'logout' %}">
                                    <i class="fas fa-power-off"></i> D√©connexion
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'change_password' %}">
                                    <i class="fas fa-key"></i> Change password
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                {% else %}
                <a href="{% url 'login' %}" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Connexion
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</header>

<!-- Overlay pour fermer le sidebar sur mobile -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>